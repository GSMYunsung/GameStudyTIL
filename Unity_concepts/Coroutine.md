#### 코루틴



**코루틴과 쓰레드**

닷넷은 멀티쓰레드를 지원하지만 닷넷을 사용하는 유니티는 `단일 쓰레드`로 동작한다.

**[만약 단일 쓰레드를 사용하는 유니티에서 멀티쓰레드코드를 작성한다면?]**

```
 버그 발생률이 높아지고 멀티쓰레드간 교착 상태 경합 등, 신경써야 할 부분이 많아진다. 
```

따라서 단일 쓰레드를 사용하는것이 좋다.   <br>

하지만 꼭 멀티쓰레드 코드를 작성해야하는 일이 생긴다면 대처하지 못할 수도있다.  <br>

여기서 이것을 해결해 주는 것이 `유니티 코루틴(Coroutine)`이다.   <br>

`일반적인 쓰레드 방식의 프로그래밍`을 유니티에서는 코루틴을 사용함으로써 `멀티 쓰레드를 흉내` 를 낼 수 있다.



**코루틴의 동작방식**

꼭 멀티쓰레드를 써야할때 쓰레드를 사용하지 않고  멀티 테스킹을 가능하게 한다.  <br>

`어떤방법으로 구현할 수있을까?`

코루틴 함수가 IEnumerator 를 반환하는데 힌트를 얻을 수있다.<br>

```
일반적으로 함수가 호출되서 끝나는 일반적인 함수의 서브루틴의 개념과 달리 
yield return을사용함으로 그 위치를 기억하고 다음 호출 때 그곳부터 다음을 실행 할 수있도록 하는 것이다.
```

 그래서 여러개의 코루틴을 동작시키고 각기다른 시점에 yield가 반환되도록 한다면 마치 어러개의 쓰래드가 동시에 동작하는것과 같은 효과가 나타난다. <br>

유니티의 Update 함수는 1프래임에 한 번 호출 된다. <br>

매 프래임마다 yield return 할 코루틴이 있는지 체크하는데 코루틴의 yield 종류마다 그 시점이 다르다.  하지만

대부분은 Update 에서 체크된다. <br>



**코루틴의 종류 **

```
yield 코루틴은 다음 프레임에서 모든 Update 함수가 호출된 후에 속행합니다.
```

[yield WaitForSeconds]  : 프레임에 대한 모든 Update 함수가 호출된 후 `지정된 시간 지연 후`에 속행합니다.

[yield WaitForFixedUpdate] :  모든 스크립트에서 모든 `FixedUpdate 호출 후` 속행합니다.

[yield WWW WWW] : `다운로드 완료 후 속행`합니다.

[yield StartCoroutine]  : 코루틴을 연결하고 *`MyFunc 코루틴`이 먼저 완료될 때까지 기다립니다.



**Coroutine 과 Invoke **

[Invoke]

함수를 원하는시점에 호출할 수있도록 해주는 함수이다. 

InvokeRepeating를 사용하여 함수를 반복적으로 호출 할 수도있다. 

내부적으로 `타이머에 의해 해당 시간이 되었는지 체크`하여 시간이 되면 호출하는 방식이다.

[Invoke]

하지만 Invoke는 파라미터를 전달할 수없다.

매 프래임마다 체크하여 돌아갈 지점으로 돌아가는 방식이다.
